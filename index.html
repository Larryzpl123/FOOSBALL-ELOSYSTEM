<!DOCTYPE html>
<html lang="en">
<head>
  <!-- [Previous meta, style, and other head elements remain the same] -->
</head>
<body>
  <!-- [Previous HTML structure remains the same] -->

  <script>
    // [Previous constants and utility functions remain the same until processCommand]

    // --------------------------
    // Command Processors
    // --------------------------

    function processWin(attackerName, defenderName, winType) {
      const attackerKey = canonicalize(attackerName);
      const defenderKey = canonicalize(defenderName);
      
      if (!players[attackerKey] || !players[defenderKey]) {
        printOutput("Error: One or both players not found.");
        return;
      }

      const attacker = players[attackerKey];
      const defender = players[defenderKey];
      const multiplier = WIN_TYPE_MULTIPLIERS[winType.toLowerCase()] || 1.0;
      const k = K_FACTOR * multiplier;

      // Calculate Elo changes
      const aOff = attacker.offense;
      const dDef = defender.defense;
      const expected = 1 / (1 + Math.pow(10, (dDef - aOff) / 400));
      const delta = Math.round(k * (1 - expected));

      // Update attacker offense
      attacker.offense = Math.min(RATING_MAX, Math.max(RATING_MIN, aOff + delta));
      
      // Update defender defense
      defender.defense = Math.min(RATING_MAX, Math.max(RATING_MIN, dDef - delta));

      // Update match counters
      attacker.played += 1;
      attacker.wins += 1;
      defender.played += 1;

      // Update ranks and averages
      update_player_avg(attackerKey);
      update_player_ranks(attackerKey);
      update_player_avg(defenderKey);
      update_player_ranks(defenderKey);

      printOutput(`${attacker.display} defeats ${defender.display} (${winType}):\n` +
                 `  ${attacker.display} offense: ${aOff} → ${attacker.offense}\n` +
                 `  ${defender.display} defense: ${dDef} → ${defender.defense}`);
    }

    function processCommand(command) {
      command = command.trim();
      if (!command) return;
      const tokens = command.split(/\s+/);
      const base = tokens[0].toLowerCase();

      // [Existing pp, add, best commands here]

      // Handle win commands
      if (base in WIN_TYPE_MULTIPLIERS) {
        if (tokens.length < 3) {
          printOutput(`Usage: ${base} [attacker] [defender]`);
          return;
        }
        processWin(tokens[1], tokens[2], base);
      } 
      else if (base === 'wins') {
        if (tokens.length < 3) {
          printOutput("Usage: wins [attacker] [defender] [win-type=win]");
          return;
        }
        const winType = tokens[3] ? tokens[3].toLowerCase() : 'win';
        if (!WIN_TYPE_MULTIPLIERS[winType]) {
          printOutput(`Invalid win type. Valid types: ${Object.keys(WIN_TYPE_MULTIPLIERS).join(', ')}`);
          return;
        }
        processWin(tokens[1], tokens[2], winType);
      }
      // Handle rank command
      else if (base === 'rank') {
        let output = "Rank Thresholds:\n";
        RANK_THRESHOLDS.forEach(rt => {
          output += `- ${rt.rank.padEnd(8)} ${rt.threshold}+\n`;
        });
        printOutput(output);
      }
      else {
        printOutput(`Unsupported command. Available commands: pp, add, best, rank, ` +
                   `wins, ${Object.keys(WIN_TYPE_MULTIPLIERS).join(', ')}`);
      }
      
      updateSaveDataArea();
    }

    // [Remaining JavaScript code remains the same]
  </script>
</body>
</html>